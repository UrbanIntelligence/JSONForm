<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JSON Form</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-1: #f7f2e8;
      --bg-2: #e9f2f1;
      --ink: #1a1a1a;
      --muted: #5b5b5b;
      --accent: #1c6b5a;
      --accent-2: #0a2e3f;
      --card: #ffffff;
      --ring: rgba(28, 107, 90, 0.35);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Space Grotesk", system-ui, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(28, 107, 90, 0.18), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(10, 46, 63, 0.12), transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px 48px;
    }

    .wrap {
      width: min(1000px, 100%);
      display: grid;
      gap: 20px;
      grid-template-columns: 1.1fr 0.9fr;
    }

    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
    }

    h1 {
      font-size: clamp(28px, 2.5vw, 36px);
      margin: 0 0 6px 0;
      letter-spacing: -0.02em;
    }

    .subtitle {
      color: var(--muted);
      margin: 0 0 18px 0;
      font-size: 14px;
    }

    form {
      display: grid;
      gap: 14px;
      grid-template-columns: 1fr 1fr;
    }

    @media (max-width: 700px) {
      form { grid-template-columns: 1fr; }
    }

    label {
      display: grid;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    input, select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.12);
      font-size: 15px;
      font-family: "Space Grotesk", system-ui, sans-serif;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--ring);
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 8px;
      grid-column: 1 / -1;
    }

    .delete-wrap {
      display: grid;
      gap: 6px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .delete-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .delete-row input {
      width: 140px;
    }

    button {
      border: none;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 600;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 10px 20px rgba(28, 107, 90, 0.25);
    }

    .btn-primary:hover { transform: translateY(-1px); }

    .btn-ghost {
      background: transparent;
      color: var(--accent-2);
      border: 1px solid rgba(10, 46, 63, 0.2);
    }

    .hint {
      font-size: 12px;
      color: var(--muted);
    }

    .preview {
      font-family: "Source Code Pro", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 12.5px;
      background: #0f1720;
      color: #d9e2ec;
      border-radius: 16px;
      padding: 16px;
      min-height: 260px;
      white-space: pre-wrap;
    }

    .entry-list {
      margin-top: 14px;
      display: grid;
      gap: 10px;
    }

    .entry-card {
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      padding: 12px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: #fff;
    }

    .entry-meta {
      font-size: 13px;
      color: var(--muted);
    }

    .entry-id {
      font-weight: 700;
      color: var(--accent-2);
      font-size: 14px;
    }

    .entry-actions {
      display: flex;
      gap: 8px;
    }

    .entry-actions button {
      padding: 8px 12px;
      font-size: 12px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(28, 107, 90, 0.12);
      color: var(--accent-2);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .count {
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <div class="badge">JSON Intake</div>
      <h1>Online JSON Form</h1>
      <p class="subtitle">Collect entries and build a JSON file directly in the browser.</p>

      <form id="json-form" autocomplete="off">
        <label>
          First Name
          <input name="firstName" type="text" placeholder="Ada" required />
        </label>
        <label>
          Last Name
          <input name="lastName" type="text" placeholder="Lovelace" required />
        </label>
        <label>
          Age
          <input name="age" type="number" min="0" max="130" placeholder="28" required />
        </label>
        <label>
          Sex
          <select name="sex" required>
            <option value="" disabled selected>Select</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Prefer not to say</option>
          </select>
        </label>
        <label>
          Nationality
          <input name="nationality" type="text" placeholder="Canadian" required />
        </label>
        <label>
          Phone Number
          <input name="phone" type="tel" placeholder="+1 555 123 4567" required />
        </label>

        <div class="actions">
          <button class="btn-primary" type="submit">Add</button>
          <button class="btn-ghost" type="button" id="download">Download JSON</button>
          <button class="btn-ghost" type="button" id="refresh">Refresh</button>
          <label class="delete-wrap">
            Delete by ID
            <div class="delete-row">
              <input name="deleteId" id="deleteId" type="number" min="1" placeholder="Entry ID" />
              <button class="btn-ghost" type="button" id="delete">Delete</button>
            </div>
          </label>
          <span class="hint" id="status">Ready.</span>
        </div>
      </form>
    </section>

    <section class="card">
      <div class="row">
        <div>
          <div class="badge">Preview</div>
          <div class="count" id="count">0 entries</div>
        </div>
      </div>
      <div id="preview" class="preview">[]</div>
      <div id="entryList" class="entry-list"></div>
    </section>
  </div>

  <script>
    const API_BASE = "https://json-form-api.myjsonforms.workers.dev";
    const API_URL = `${API_BASE}/entries`;

    const form = document.getElementById("json-form");
    const preview = document.getElementById("preview");
    const countEl = document.getElementById("count");
    const downloadBtn = document.getElementById("download");
    const refreshBtn = document.getElementById("refresh");
    const deleteBtn = document.getElementById("delete");
    const deleteIdInput = document.getElementById("deleteId");
    const statusEl = document.getElementById("status");
    const entryList = document.getElementById("entryList");

    let entries = [];

    const setStatus = (message) => {
      statusEl.textContent = message;
    };

    const render = () => {
      preview.textContent = JSON.stringify(entries, null, 2);
      countEl.textContent = `${entries.length} entr${entries.length === 1 ? "y" : "ies"}`;
      downloadBtn.disabled = entries.length === 0;
      entryList.innerHTML = "";
      if (entries.length === 0) return;
      for (const entry of entries) {
        const row = document.createElement("div");
        row.className = "entry-card";
        row.innerHTML = `
          <div>
            <div class="entry-id">ID ${entry.id}</div>
            <div class="entry-meta">${entry.firstName} ${entry.lastName} · ${entry.nationality} · ${entry.phone}</div>
          </div>
          <div class="entry-actions">
            <button class="btn-ghost" data-delete="${entry.id}">Delete</button>
          </div>
        `;
        entryList.appendChild(row);
      }
    };

    const loadEntries = async () => {
      try {
        setStatus("Loading...");
        const res = await fetch(API_URL, { method: "GET" });
        if (!res.ok) throw new Error("Failed to load entries");
        entries = await res.json();
        render();
        setStatus("Ready.");
      } catch (err) {
        setStatus("Unable to reach the API. Check the API URL.");
      }
    };

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const data = new FormData(form);
      const entry = {
        firstName: data.get("firstName").trim(),
        lastName: data.get("lastName").trim(),
        age: Number(data.get("age")),
        sex: data.get("sex"),
        nationality: data.get("nationality").trim(),
        phone: data.get("phone").trim()
      };

      try {
        setStatus("Saving...");
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(entry)
        });
        if (!res.ok) throw new Error("Failed to save");
        const saved = await res.json();
        entries.unshift(saved);
        render();
        setStatus("Saved.");
        form.reset();
        form.querySelector("input[name=firstName]").focus();
      } catch (err) {
        setStatus("Save failed. Check the API URL.");
      }
    });

    downloadBtn.addEventListener("click", async () => {
      try {
        setStatus("Preparing download...");
        const res = await fetch(API_URL, { method: "GET" });
        if (!res.ok) throw new Error("Failed to fetch");
        const data = await res.json();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "entries.json";
        a.click();
        URL.revokeObjectURL(url);
        setStatus("Download ready.");
      } catch (err) {
        setStatus("Download failed.");
      }
    });

    refreshBtn.addEventListener("click", loadEntries);

    deleteBtn.addEventListener("click", async () => {
      const id = Number(deleteIdInput.value);
      if (!Number.isInteger(id) || id <= 0) {
        setStatus("Enter a valid ID to delete.");
        return;
      }

      const ok = window.confirm(`Delete entry ${id}? This cannot be undone.`);
      if (!ok) return;

      try {
        setStatus("Deleting...");
        const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        if (!res.ok) {
          if (res.status === 404) {
            setStatus("ID not found.");
            return;
          }
          throw new Error("Failed to delete");
        }
        entries = entries.filter((entry) => entry.id !== id);
        render();
        setStatus("Deleted.");
        deleteIdInput.value = "";
      } catch (err) {
        setStatus("Delete failed. Check the API URL.");
      }
    });

    entryList.addEventListener("click", async (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      const id = Number(target.dataset.delete);
      if (!Number.isInteger(id) || id <= 0) return;

      try {
        setStatus("Deleting...");
        const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        if (!res.ok) {
          if (res.status === 404) {
            setStatus("ID not found.");
            return;
          }
          throw new Error("Failed to delete");
        }
        entries = entries.filter((entry) => entry.id !== id);
        render();
        setStatus("Deleted.");
      } catch (err) {
        setStatus("Delete failed. Check the API URL.");
      }
    });

    loadEntries();
  </script>
</body>
</html>
